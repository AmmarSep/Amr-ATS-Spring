<html xmlns:th="https://www.thymeleaf.org" ng-app="atsApp">
<head>
<title>ATS - Admin Home</title>
<link href="https://unpkg.com/tailwindcss@^1.0/dist/tailwind.min.css"
	rel="stylesheet">
<link rel="stylesheet" type="text/css"
	th:href="@{/assets/css/style.css}"></link>
<script type="text/javascript"
	src="https://ajax.googleapis.com/ajax/libs/angularjs/1.7.8/angular.min.js"></script>
<style>
	@keyframes fadeIn {
		from {
			opacity: 0;
			transform: translateY(20px);
		}
		to {
			opacity: 1;
			transform: translateY(0);
		}
	}
	
	.animate-fadeIn {
		animation: fadeIn 0.6s ease-out forwards;
	}
	
	/* Smooth page transitions */
	body {
		transition: all 0.3s ease-in-out;
	}
	
	/* Enhanced hover effects for navigation */
	.nav-item {
		position: relative;
		overflow: hidden;
	}
	
	.nav-item::before {
		content: '';
		position: absolute;
		top: 0;
		left: -100%;
		width: 100%;
		height: 100%;
		background: linear-gradient(90deg, transparent, rgba(255,255,255,0.1), transparent);
		transition: left 0.5s;
	}
	
	.nav-item:hover::before {
		left: 100%;
	}
	
	/* Compact Navigation Styles */
	.sidebar-nav {
		flex-shrink: 0;
	}
	
	.nav-item-compact {
		min-height: 40px;
		display: flex;
		align-items: center;
	}
	
	.nav-link-compact {
		padding: 10px 16px !important;
		font-size: 14px !important;
		line-height: 1.4 !important;
		text-decoration: none;
		display: flex;
		align-items: center;
		min-height: 40px;
		box-sizing: border-box;
	}
	
	.nav-link-compact:hover {
		text-decoration: none;
	}

	/* Compact Main Content Styles */
	.main-content-compact {
		font-size: 14px;
	}
	
	.main-content-compact h2 {
		font-size: 20px !important;
		font-weight: 600 !important;
		margin-bottom: 16px !important;
	}
	
	.main-content-compact h3 {
		font-size: 16px !important;
		font-weight: 500 !important;
		margin-bottom: 12px !important;
	}
	
	/* Compact Table Styles */
	.table-compact {
		font-size: 13px;
	}
	
	.table-compact th {
		padding: 8px 12px !important;
		font-size: 12px !important;
		font-weight: 600 !important;
		text-transform: uppercase;
		letter-spacing: 0.5px;
		background-color: #f8f9fa !important;
	}
	
	.table-compact td {
		padding: 6px 12px !important;
		font-size: 13px !important;
		line-height: 1.4 !important;
		vertical-align: middle !important;
	}
	
	/* Compact Action Buttons */
	.action-btn-compact {
		padding: 4px 8px !important;
		font-size: 11px !important;
		font-weight: 500 !important;
		text-transform: uppercase;
		letter-spacing: 0.3px;
		border-radius: 4px !important;
		line-height: 1.2 !important;
		min-width: 50px;
		text-align: center;
	}
	
	/* Compact Status Badges */
	.status-badge-compact {
		padding: 3px 8px !important;
		font-size: 11px !important;
		font-weight: 500 !important;
		text-transform: uppercase;
		letter-spacing: 0.3px;
		border-radius: 12px !important;
		line-height: 1.2 !important;
	}
	
	/* Compact Form Elements */
	.form-compact input, .form-compact select, .form-compact textarea {
		padding: 6px 10px !important;
		font-size: 13px !important;
		line-height: 1.4 !important;
	}
	
	.form-compact label {
		font-size: 12px !important;
		font-weight: 500 !important;
		margin-bottom: 4px !important;
	}
	
	.form-compact button {
		padding: 6px 12px !important;
		font-size: 12px !important;
		font-weight: 500 !important;
	}
</style>
</head>
<body ng-controller="adminHomeController">
	<nav
		class="flex items-center justify-between flex-wrap bg-gray-700 p-6">
		<div class="flex items-center flex-shrink-0 text-white mr-6">
			<span class="font-semibold text-xl tracking-tight">Spring ATS</span>
		</div>
		<div class="w-full block flex-grow lg:flex lg:items-center lg:w-auto">
			<div class="text-sm lg:flex-grow"></div>
			<div>
				<a href="#" class="inline-block mt-0 text-white mr-4"
					th:text="${username}"> Name </a> <a href="../logout"
					class="inline-block text-sm px-4 py-2 leading-none hover:text-teal-400 text-white mt-0">Logout</a>
			</div>
		</div>
	</nav>
	<div class="w-full px-4 py-4">
		<div class="flex mb-4">
			<div class="sidebar-nav" style="width: 180px; min-width: 180px;">
				<ul class="list-none" style="margin: 0; padding: 0;">
					<li
						class="nav-item-compact border border-gray-300 cursor-pointer rounded transition-all duration-300 ease-in-out hover:shadow-md"
						style="margin-bottom: 6px;"
						th:classappend="${users} ? 'text-white bg-teal-700 shadow-lg border-teal-700' :  'text-teal-700 hover:border-gray-400 hover:bg-gray-50'">
						<a th:href="@{/admin/users}" class="nav-link-compact block w-full h-full transition-colors duration-200">Manage Users</a>
					</li>
					<li
						class="nav-item-compact border border-gray-300 cursor-pointer rounded transition-all duration-300 ease-in-out hover:shadow-md"
						style="margin-bottom: 6px;"
						th:classappend="${jobs} ? 'text-white bg-teal-700 shadow-lg border-teal-700' :  'text-teal-700 hover:border-gray-400 hover:bg-gray-50'">
						<a th:href="@{/admin/jobs}" class="nav-link-compact block w-full h-full transition-colors duration-200">Job Postings</a>
					</li>
					<li
						class="nav-item-compact border border-gray-300 cursor-pointer rounded transition-all duration-300 ease-in-out hover:shadow-md"
						style="margin-bottom: 6px;"
						th:classappend="${applications} ? 'text-white bg-teal-700 shadow-lg border-teal-700' :  'text-teal-700 hover:border-gray-400 hover:bg-gray-50'">
						<a th:href="@{/admin/applications}" class="nav-link-compact block w-full h-full transition-colors duration-200">Applications</a>
					</li>
					<li
						class="nav-item-compact border border-gray-300 cursor-pointer rounded transition-all duration-300 ease-in-out hover:shadow-md"
						style="margin-bottom: 6px;"
						th:classappend="${recruiters} ? 'text-white bg-teal-700 shadow-lg border-teal-700' :  'text-teal-700 hover:border-gray-400 hover:bg-gray-50'">
						<a th:href="@{/admin/recruiters}" class="nav-link-compact block w-full h-full transition-colors duration-200">Manage Recruiters</a>
					</li>
					<li
						class="nav-item-compact border border-gray-300 cursor-pointer rounded transition-all duration-300 ease-in-out hover:shadow-md"
						style="margin-bottom: 6px;"
						th:classappend="${hiredCandidates} ? 'text-white bg-teal-700 shadow-lg border-teal-700' :  'text-teal-700 hover:border-gray-400 hover:bg-gray-50'">
						<a th:href="@{/admin/hired-candidates}" class="nav-link-compact block w-full h-full transition-colors duration-200">Hired Candidates</a>
					</li>
					<li
						class="nav-item-compact border border-gray-300 cursor-pointer rounded transition-all duration-300 ease-in-out hover:shadow-md"
						style="margin-bottom: 0;"
						th:classappend="${interviewScheduledCandidates} ? 'text-white bg-teal-700 shadow-lg border-teal-700' :  'text-teal-700 hover:border-gray-400 hover:bg-gray-50'">
						<a th:href="@{/admin/interview-scheduled}" class="nav-link-compact block w-full h-full transition-colors duration-200">Interview Scheduled</a>
					</li>
				</ul>
			</div>

			<div th:if="${users}" class="flex-1 ml-4 h-auto p-4 border-2 rounded opacity-0 animate-fadeIn">
				<div th:replace="fragments/admin/users :: all-users"></div>
			</div>
			<div th:if="${jobs}" class="main-content-compact flex-1 ml-4 h-auto p-4 border-2 rounded opacity-0 animate-fadeIn">
				<h2>Job Postings Management</h2>
				
				<button onclick="document.getElementById('createJobForm').classList.toggle('hidden')" 
					class="action-btn-compact bg-teal-700 text-white hover:bg-teal-800 mb-3">+ Create New Job</button>
				
				<div id="createJobForm" class="hidden mb-4 p-3 border rounded bg-gray-50 form-compact">
					<h3>Create Job Posting</h3>
					<form th:action="@{/admin/job/create}" method="post">
						<div class="grid grid-cols-2 gap-3">
							<input type="text" name="jobTitle" placeholder="Job Title" required class="border rounded" />
							<input type="text" name="location" placeholder="Location" required class="border rounded" />
							<input type="text" name="jobType" placeholder="Job Type (e.g., Full-time)" required class="border rounded" />
							<input type="text" name="experienceRequired" placeholder="Experience Required" required class="border rounded" />
						</div>
						<textarea name="jobDescription" placeholder="Job Description" required class="border rounded w-full mt-2" rows="2"></textarea>
						<textarea name="requiredSkills" placeholder="Required Skills (comma separated)" required class="border rounded w-full mt-2" rows="2"></textarea>
						<div class="mt-3">
							<button type="submit" class="action-btn-compact bg-teal-700 text-white hover:bg-teal-800">Create Job</button>
							<button type="button" onclick="document.getElementById('createJobForm').classList.add('hidden')" 
								class="action-btn-compact bg-gray-500 text-white hover:bg-gray-600 ml-2">Cancel</button>
						</div>
					</form>
				</div>
				
				<div class="overflow-x-auto">
					<table class="table-compact w-full border-collapse min-w-max">
						<thead>
							<tr>
								<th class="border text-left w-8">#</th>
								<th class="border text-left w-48">Job Title</th>
								<th class="border text-left w-32">Location</th>
								<th class="border text-left w-20">Type</th>
								<th class="border text-left w-16">Status</th>
								<th class="border text-left w-32">Posted On</th>
								<th class="border text-left w-32">Actions</th>
							</tr>
						</thead>
						<tbody>
							<tr th:if="${jobs.isEmpty()}">
								<td colspan="7" class="border p-3 text-center text-gray-500 text-sm">No job postings available. Create one to get started.</td>
							</tr>
							<tr th:each="job, iterStat : ${jobs}" class="hover:bg-gray-50">
								<td class="border" th:text="${iterStat.count}">1</td>
								<td class="border" th:text="${job.jobTitle}">Job Title</td>
								<td class="border" th:text="${job.location}">Location</td>
								<td class="border" th:text="${job.jobType}">Type</td>
								<td class="border">
									<span th:if="${job.isActive}" class="status-badge-compact bg-green-600 text-white">Active</span>
									<span th:unless="${job.isActive}" class="status-badge-compact bg-red-600 text-white">Inactive</span>
								</td>
								<td class="border" th:text="${job.postedOn}">Date</td>
								<td class="border">
									<div class="flex flex-col gap-1">
										<form th:action="@{/admin/job/toggle/{id}(id=${job.jobId})}" method="post" style="display:inline;">
											<button type="submit" class="action-btn-compact bg-blue-600 text-white hover:bg-blue-700" th:text="${job.isActive} ? 'Deactivate' : 'Activate'">Toggle</button>
										</form>
										<a th:href="@{/recruitment/job/{id}(id=${job.jobId})}" class="action-btn-compact bg-teal-600 text-white hover:bg-teal-700 text-center" target="_blank">View</a>
									</div>
								</td>
							</tr>
						</tbody>
					</table>
				</div>
			</div>
			<div th:if="${applications}" class="main-content-compact flex-1 ml-4 h-auto p-4 border-2 rounded opacity-0 animate-fadeIn">
				<h2>Applications Overview</h2>
				
				<div class="mb-3 form-compact">
					<label>Filter by Status:</label>
					<select onchange="filterApplications(this.value)" class="border rounded ml-2">
						<option value="all">All Applications</option>
						<option value="Submitted">Submitted</option>
						<option value="Screening">Screening</option>
						<option value="Interview">Interview</option>
						<option value="Hired">Hired</option>
						<option value="Rejected">Rejected</option>
					</select>
				</div>
				
				<div class="overflow-x-auto">
					<table class="table-compact w-full border-collapse min-w-max">
						<thead>
							<tr>
								<th class="border text-left w-8">#</th>
								<th class="border text-left w-32">Candidate</th>
								<th class="border text-left w-40">Job Title</th>
								<th class="border text-left w-16">AI Score</th>
								<th class="border text-left w-24">Resume</th>
								<th class="border text-left w-20">Status</th>
								<th class="border text-left w-24">Applied On</th>
								<th class="border text-left w-28">Actions</th>
							</tr>
						</thead>
					<tbody>
						<tr th:if="${applications.isEmpty()}">
							<td colspan="8" class="border p-3 text-center text-gray-500 text-sm">No applications received yet.</td>
						</tr>
						<tr th:each="app, iterStat : ${applications}" class="hover:bg-gray-50" th:attr="data-status=${app.status}">
							<td class="border" th:text="${iterStat.count}">1</td>
							<td class="border" th:text="${app.candidate?.username ?: 'N/A'}">Candidate</td>
							<td class="border" th:text="${app.jobPosting?.jobTitle ?: 'N/A'}">Job</td>
							<td class="border">
								<span th:if="${app.aiScore != null}" th:text="${#numbers.formatDecimal(app.aiScore, 1, 2)} + '%'" class="font-medium text-blue-600">Score</span>
								<span th:unless="${app.aiScore != null}" class="text-gray-400">-</span>
							</td>
							<td class="border">
								<div th:if="${app.resume != null}">
									<a th:href="@{/download/attachment(id=${app.resume.fileId})}" 
									   class="text-blue-600 hover:underline inline-flex items-center text-xs">
										<svg class="w-3 h-3 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
											<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
												  d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z">
											</path>
										</svg>
										<span th:text="${app.resume.fileOriginalName ?: 'Resume'}">Resume</span>
									</a>
								</div>
								<span th:unless="${app.resume != null}" class="text-gray-400 text-xs">No resume</span>
							</td>
							<td class="border">
								<span th:class="'status-badge-compact text-white ' + ${app.status == 'Hired' ? 'bg-green-600' : (app.status == 'Rejected' ? 'bg-red-600' : (app.status == 'Interview' ? 'bg-purple-600' : (app.status == 'Screening' ? 'bg-yellow-600' : 'bg-blue-600')))}" 
									th:text="${app.status}">Status</span>
							</td>
							<td class="border" th:text="${app.appliedOn != null ? #dates.format(app.appliedOn, 'dd-MMM-yyyy') : 'N/A'}">Date</td>
							<td class="border">
								<div class="flex flex-col gap-1">
									<a th:href="@{/admin/application/status/{id}(id=${app.applicationId},status='Screening')}" 
									   class="action-btn-compact bg-yellow-600 text-white hover:bg-yellow-700">Screen</a>
									<a th:href="@{/admin/application/status/{id}(id=${app.applicationId},status='Interview')}" 
									   class="action-btn-compact bg-purple-500 text-white hover:bg-purple-600">Interview</a>
									<a th:href="@{/admin/application/status/{id}(id=${app.applicationId},status='Hired')}" 
									   class="action-btn-compact bg-green-500 text-white hover:bg-green-600">Hire</a>
									<a th:href="@{/admin/application/status/{id}(id=${app.applicationId},status='Rejected')}" 
									   class="action-btn-compact bg-red-500 text-white hover:bg-red-600">Reject</a>
								</div>
							</td>
						</tr>
					</tbody>
					</table>
				</div>
				
				<script>
				function filterApplications(status) {
					const rows = document.querySelectorAll('tbody tr[data-status]');
					rows.forEach(row => {
						if (status === 'all' || row.getAttribute('data-status') === status) {
							row.style.display = '';
						} else {
							row.style.display = 'none';
						}
					});
				}
				</script>
			</div>
			<div th:if="${recruiters}" class="main-content-compact flex-1 ml-4 h-auto p-4 border-2 rounded opacity-0 animate-fadeIn">
				<h2>Recruiter Management</h2>
				
				<button onclick="document.getElementById('createRecruiterForm').classList.toggle('hidden')" 
					class="action-btn-compact bg-teal-700 text-white hover:bg-teal-800 mb-3">+ Add New Recruiter</button>
				
				<div id="createRecruiterForm" class="hidden mb-4 p-3 border rounded bg-gray-50 form-compact">
					<h3>Create Recruiter Account</h3>
					<form th:action="@{/admin/recruiter/create}" method="post">
						<div class="grid grid-cols-2 gap-3">
							<input type="text" name="username" placeholder="Full Name" required class="border rounded" />
							<input type="email" name="email" placeholder="Email" required class="border rounded" />
						</div>
						<div class="mt-3">
							<button type="submit" class="action-btn-compact bg-teal-700 text-white hover:bg-teal-800">Create Recruiter</button>
							<button type="button" onclick="document.getElementById('createRecruiterForm').classList.add('hidden')" 
								class="action-btn-compact bg-gray-500 text-white hover:bg-gray-600 ml-2">Cancel</button>
						</div>
					</form>
				</div>
				
				<div class="overflow-x-auto">
					<table class="table-compact w-full border-collapse min-w-max">
						<thead>
							<tr>
								<th class="border text-left w-8">#</th>
								<th class="border text-left w-32">Name</th>
								<th class="border text-left w-48">Email</th>
								<th class="border text-left w-20">Status</th>
								<th class="border text-left w-32">Created On</th>
								<th class="border text-left w-24">Actions</th>
							</tr>
						</thead>
						<tbody>
							<tr th:if="${recruiters.isEmpty()}">
								<td colspan="6" class="border p-3 text-center text-gray-500 text-sm">No recruiters found. Add one to get started.</td>
							</tr>
							<tr th:each="recruiter, iterStat : ${recruiters}" class="hover:bg-gray-50">
								<td class="border" th:text="${iterStat.count}">1</td>
								<td class="border" th:text="${recruiter.username}">Name</td>
								<td class="border" th:text="${recruiter.email}">Email</td>
								<td class="border">
									<span th:if="${!recruiter.isLocked}" class="status-badge-compact bg-green-600 text-white">Active</span>
									<span th:if="${recruiter.isLocked}" class="status-badge-compact bg-red-600 text-white">Locked</span>
								</td>
								<td class="border" th:text="${recruiter.createdOn}">Date</td>
								<td class="border">
									<form th:action="@{/admin/recruiter/toggle/{id}(id=${recruiter.userId})}" method="post" style="display:inline;">
										<button type="submit" class="action-btn-compact bg-blue-600 text-white hover:bg-blue-700" th:text="${recruiter.isLocked} ? 'Unlock' : 'Lock'">Toggle</button>
									</form>
								</td>
							</tr>
						</tbody>
					</table>
				</div>
			</div>
			<div th:if="${hiredCandidates}" class="main-content-compact flex-1 ml-4 h-auto p-4 border-2 rounded opacity-0 animate-fadeIn">
				<h2>Hired Candidates</h2>
				
				<div class="overflow-x-auto">
					<table class="table-compact w-full border-collapse min-w-max">
						<thead>
							<tr>
								<th class="border text-left w-8">#</th>
								<th class="border text-left w-48">Candidate Name</th>
								<th class="border text-left w-16">AI Score</th>
								<th class="border text-left w-32">CV</th>
								<th class="border text-left w-48">Position Applied</th>
								<th class="border text-left w-28">Hired On</th>
							</tr>
						</thead>
						<tbody>
							<tr th:if="${hiredCandidates.isEmpty()}">
								<td colspan="6" class="border p-3 text-center text-gray-500 text-sm">No candidates have been hired yet.</td>
							</tr>
							<tr th:each="candidate, iterStat : ${hiredCandidates}" class="hover:bg-gray-50">
								<td class="border" th:text="${iterStat.count}">1</td>
								<td class="border" th:text="${candidate.candidate?.username ?: 'N/A'}">Candidate Name</td>
								<td class="border">
									<span th:if="${candidate.aiScore != null}" th:text="${#numbers.formatDecimal(candidate.aiScore, 1, 2)} + '%'" class="font-medium text-green-600">Score</span>
									<span th:unless="${candidate.aiScore != null}" class="text-gray-400">-</span>
								</td>
								<td class="border">
									<div th:if="${candidate.resume != null}">
										<button onclick="viewResume(this)" 
											th:attr="data-file-id=${candidate.resume.fileId}, data-file-name=${candidate.resume.fileOriginalName}, data-download-url=@{/download/attachment(id=${candidate.resume.fileId})}"
											class="text-blue-600 hover:underline inline-flex items-center cursor-pointer bg-none border-none text-xs">
											<svg class="w-3 h-3 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
												<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
													  d="M15 12a3 3 0 11-6 0 3 3 0 016 0z M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z">
												</path>
											</svg>
											<span th:text="${candidate.resume.fileOriginalName ?: 'View CV'}">View CV</span>
										</button>
									</div>
									<span th:unless="${candidate.resume != null}" class="text-gray-400 text-xs">No CV</span>
								</td>
								<td class="border" th:text="${candidate.jobPosting?.jobTitle ?: 'N/A'}">Position</td>
								<td class="border" th:text="${candidate.appliedOn != null ? #dates.format(candidate.appliedOn, 'dd-MMM-yyyy') : 'N/A'}">Date</td>
							</tr>
						</tbody>
					</table>
				</div>
				
				<!-- Resume Viewer Modal -->
				<div id="resumeModal" class="fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full hidden z-50">
					<div class="relative top-20 mx-auto p-5 border w-11/12 max-w-4xl shadow-lg rounded-md bg-white">
						<div class="flex justify-between items-center mb-4">
							<h3 class="text-lg font-bold" id="resumeModalTitle">Resume Viewer</h3>
							<button onclick="closeResumeModal()" class="text-gray-400 hover:text-gray-600">
								<svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
									<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
								</svg>
							</button>
						</div>
						<div id="resumeContent" class="h-96 overflow-auto border rounded">
							<iframe id="resumeFrame" src="" width="100%" height="100%" frameborder="0"></iframe>
						</div>
					</div>
				</div>
				
				<script>
				function viewResume(button) {
					const fileId = button.getAttribute('data-file-id');
					const fileName = button.getAttribute('data-file-name');
					const downloadUrl = button.getAttribute('data-download-url');
					
					if (!fileId) {
						alert('File ID not found');
						return;
					}
					
					console.log('Opening resume with ID:', fileId, 'in new tab');
					// Directly open the download URL in a new tab for viewing
					window.open(downloadUrl, '_blank');
				}
				
				function closeResumeModal() {
					document.getElementById('resumeModal').classList.add('hidden');
					document.getElementById('resumeFrame').src = '';
				}
				
				// Close modal when clicking outside
				document.getElementById('resumeModal').addEventListener('click', function(e) {
					if (e.target === this) {
						closeResumeModal();
					}
				});
				</script>
			</div>
			<div th:if="${interviewScheduledCandidates}" class="main-content-compact flex-1 ml-4 h-auto p-4 border-2 rounded opacity-0 animate-fadeIn">
				<h2>Interview Scheduled Candidates</h2>
				
				<div class="overflow-x-auto">
					<table class="table-compact w-full border-collapse min-w-max">
						<thead>
							<tr>
								<th class="border text-left w-8">#</th>
								<th class="border text-left w-32">Candidate Name</th>
								<th class="border text-left w-16">AI Score</th>
								<th class="border text-left w-24">CV</th>
								<th class="border text-left w-32">Position Applied</th>
								<th class="border text-left w-24">Interview Date</th>
								<th class="border text-left w-24">Interview Time</th>
								<th class="border text-left w-28">Actions</th>
							</tr>
						</thead>
						<tbody>
							<tr th:if="${interviewScheduledCandidates.isEmpty()}">
								<td colspan="8" class="border p-3 text-center text-gray-500 text-sm">No candidates are scheduled for interviews yet.</td>
							</tr>
							<tr th:each="candidate, iterStat : ${interviewScheduledCandidates}" class="hover:bg-gray-50">
								<td class="border" th:text="${iterStat.count}">1</td>
								<td class="border" th:text="${candidate.candidate?.username ?: 'N/A'}">Candidate Name</td>
								<td class="border">
									<span th:if="${candidate.aiScore != null}" th:text="${#numbers.formatDecimal(candidate.aiScore, 1, 2)} + '%'" class="font-medium text-purple-600">Score</span>
									<span th:unless="${candidate.aiScore != null}" class="text-gray-400">-</span>
								</td>
								<td class="border">
									<div th:if="${candidate.resume != null}">
										<button onclick="viewInterviewResume(this)" 
											th:attr="data-file-id=${candidate.resume.fileId}, data-file-name=${candidate.resume.fileOriginalName}, data-download-url=@{/download/attachment(id=${candidate.resume.fileId})}"
											class="text-blue-600 hover:underline inline-flex items-center cursor-pointer bg-none border-none text-xs">
											<svg class="w-3 h-3 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
												<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
													  d="M15 12a3 3 0 11-6 0 3 3 0 016 0z M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z">
												</path>
											</svg>
											<span th:text="${candidate.resume.fileOriginalName ?: 'View CV'}">View CV</span>
										</button>
									</div>
									<span th:unless="${candidate.resume != null}" class="text-gray-400 text-xs">No CV</span>
								</td>
								<td class="border" th:text="${candidate.jobPosting?.jobTitle ?: 'N/A'}">Position</td>
								<td class="border">
									<span th:if="${candidate.interviewDate != null}" th:text="${#dates.format(candidate.interviewDate, 'dd-MMM-yyyy')}" class="font-medium text-xs">Date</span>
									<span th:unless="${candidate.interviewDate != null}" class="text-gray-500 italic text-xs">Not Scheduled</span>
								</td>
								<td class="border">
									<span th:if="${candidate.interviewTime != null}" th:text="${#dates.format(candidate.interviewTime, 'hh:mm a')}" class="font-medium text-xs">Time</span>
									<span th:unless="${candidate.interviewTime != null}" class="text-gray-500 italic text-xs">Not Scheduled</span>
								</td>
								<td class="border">
									<div class="flex flex-col gap-1">
										<button th:if="${candidate.interviewDate == null}" 
											onclick="openScheduleModal(this)" 
											th:attr="data-application-id=${candidate.applicationId}, data-candidate-name=${candidate.candidate?.username}"
											class="action-btn-compact bg-blue-500 text-white hover:bg-blue-600">Schedule</button>
										<button th:if="${candidate.interviewDate != null}" 
											onclick="openEditModal(this)" 
											th:attr="data-application-id=${candidate.applicationId}, data-candidate-name=${candidate.candidate?.username}, data-interview-date=${candidate.interviewDate}, data-interview-time=${candidate.interviewTime}, data-interviewer-name=${candidate.interviewerName}, data-interview-location=${candidate.interviewLocation}"
											class="action-btn-compact bg-amber-500 text-white hover:bg-amber-600">Edit</button>
										<form th:if="${candidate.interviewDate != null}" th:action="@{/admin/interview/cancel/{id}(id=${candidate.applicationId})}" method="post" style="display:inline;">
											<button type="submit" class="action-btn-compact bg-red-500 text-white hover:bg-red-600 w-full" onclick="return confirm('Are you sure you want to cancel this interview?')">Cancel</button>
										</form>
									</div>
								</td>
							</tr>
						</tbody>
					</table>
				</div>
				
				<!-- Interview Scheduling Modal -->
				<div id="interviewModal" class="fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full hidden z-50">
					<div class="relative top-20 mx-auto p-5 border w-11/12 max-w-2xl shadow-lg rounded-md bg-white">
						<div class="flex justify-between items-center mb-4">
							<h3 class="text-lg font-bold" id="interviewModalTitle">Schedule Interview</h3>
							<button onclick="closeInterviewModal()" class="text-gray-400 hover:text-gray-600">
								<svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
									<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
								</svg>
							</button>
						</div>
						<form id="interviewForm" method="post" action="">
							<input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
							<div class="grid grid-cols-1 gap-4">
								<div>
									<label class="block text-sm font-medium text-gray-700">Candidate</label>
									<input type="text" id="candidateName" readonly class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md bg-gray-100">
								</div>
								<div class="grid grid-cols-2 gap-4">
									<div>
										<label class="block text-sm font-medium text-gray-700">Interview Date <span class="text-red-500">*</span></label>
										<input type="date" name="interviewDate" id="interviewDate" required class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
									</div>
									<div>
										<label class="block text-sm font-medium text-gray-700">Interview Time <span class="text-red-500">*</span></label>
										<input type="time" name="interviewTime" id="interviewTime" required class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
									</div>
								</div>
								<div>
									<label class="block text-sm font-medium text-gray-700">Interviewer Name</label>
									<input type="text" name="interviewerName" id="interviewerName" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
								</div>
								<div>
									<label class="block text-sm font-medium text-gray-700">Interview Location/Meeting Link</label>
									<input type="text" name="interviewLocation" id="interviewLocation" placeholder="Office Room or Zoom/Teams link" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
								</div>
							</div>
							<div class="mt-6 flex justify-end space-x-3">
								<button type="button" onclick="closeInterviewModal()" class="px-4 py-2 border border-gray-300 rounded-md text-sm font-medium text-gray-700 hover:bg-gray-50">Cancel</button>
								<button type="submit" id="submitInterviewBtn" class="px-4 py-2 bg-blue-600 border border-transparent rounded-md text-sm font-medium text-white hover:bg-blue-700">Save Interview</button>
							</div>
						</form>
					</div>
				</div>
				
				<script>
				let currentApplicationId = null;
				let currentMode = 'schedule'; // 'schedule' or 'edit'
				
				function openScheduleModal(button) {
					currentApplicationId = button.getAttribute('data-application-id');
					currentMode = 'schedule';
					
					document.getElementById('interviewModalTitle').textContent = 'Schedule Interview';
					document.getElementById('candidateName').value = button.getAttribute('data-candidate-name');
					
					// Set form action with context path
					const formAction = window.location.origin + '/ats/admin/interview/schedule/' + currentApplicationId;
					document.getElementById('interviewForm').setAttribute('action', formAction);
					
					// Clear form fields
					document.getElementById('interviewDate').value = '';
					document.getElementById('interviewTime').value = '';
					document.getElementById('interviewerName').value = '';
					document.getElementById('interviewLocation').value = '';
					
					document.getElementById('interviewModal').classList.remove('hidden');
				}
				
				function openEditModal(button) {
					currentApplicationId = button.getAttribute('data-application-id');
					currentMode = 'edit';
					
					document.getElementById('interviewModalTitle').textContent = 'Edit Interview';
					document.getElementById('candidateName').value = button.getAttribute('data-candidate-name');
					
					// Set form action with context path
					const formAction = window.location.origin + '/ats/admin/interview/update/' + currentApplicationId;
					document.getElementById('interviewForm').setAttribute('action', formAction);
					
					// Pre-fill form fields
					const interviewDate = button.getAttribute('data-interview-date');
					const interviewTime = button.getAttribute('data-interview-time');
					
					if (interviewDate && interviewDate !== 'null') {
						document.getElementById('interviewDate').value = interviewDate;
					}
					if (interviewTime && interviewTime !== 'null') {
						document.getElementById('interviewTime').value = interviewTime;
					}
					document.getElementById('interviewerName').value = button.getAttribute('data-interviewer-name') || '';
					document.getElementById('interviewLocation').value = button.getAttribute('data-interview-location') || '';
					
					document.getElementById('interviewModal').classList.remove('hidden');
				}
				
				function closeInterviewModal() {
					document.getElementById('interviewModal').classList.add('hidden');
					currentApplicationId = null;
				}
				
				function viewInterviewResume(button) {
					const fileId = button.getAttribute('data-file-id');
					const fileName = button.getAttribute('data-file-name');
					const downloadUrl = button.getAttribute('data-download-url');
					
					if (!fileId) {
						alert('File ID not found');
						return;
					}
					
					console.log('Opening interview candidate resume with ID:', fileId, 'in new tab');
					// Directly open the download URL in a new tab for viewing
					window.open(downloadUrl, '_blank');
				}
				
				// Close modal when clicking outside
				document.getElementById('interviewModal').addEventListener('click', function(e) {
					if (e.target === this) {
						closeInterviewModal();
					}
				});
				</script>
			</div>

		</div>
	</div>
	<script type="text/javascript" th:src="@{/assets/js/app.js}"></script>
	<script type="text/javascript" th:src="@{/assets/js/controller.js}"></script>
</body>
</html>