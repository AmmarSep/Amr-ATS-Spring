<html xmlns:th="https://www.thymeleaf.org" ng-app="atsApp">
<head>
<title>ATS - Admin Home</title>
<link href="https://unpkg.com/tailwindcss@^1.0/dist/tailwind.min.css"
	rel="stylesheet">
<link rel="stylesheet" type="text/css"
	th:href="@{/assets/css/style.css}"></link>
<script type="text/javascript"
	src="https://ajax.googleapis.com/ajax/libs/angularjs/1.7.8/angular.min.js"></script>
</head>
<body ng-controller="adminHomeController">
	<nav
		class="flex items-center justify-between flex-wrap bg-gray-700 p-6">
		<div class="flex items-center flex-shrink-0 text-white mr-6">
			<span class="font-semibold text-xl tracking-tight">Spring ATS</span>
		</div>
		<div class="w-full block flex-grow lg:flex lg:items-center lg:w-auto">
			<div class="text-sm lg:flex-grow"></div>
			<div>
				<a href="#" class="inline-block mt-0 text-white mr-4"
					th:text="${username}"> Name </a> <a href="../logout"
					class="inline-block text-sm px-4 py-2 leading-none hover:text-teal-400 text-white mt-0">Logout</a>
			</div>
		</div>
	</nav>
	<div class="container mx-auto m-4">
		<div class="flex mb-4">
			<div class="w-1/4 h-64">
				<ul class="list-none">
					<li
						class="p-4 border-2 border-white cursor-pointer rounded hover:font-medium"
						th:classappend="${users} ? 'text-white bg-teal-700' :  'text-teal-700 hover:border-gray-300'">
						<a th:href="@{/admin/users}">Manage Users</a>
					</li>
					<li
						class="p-4 border-2 border-white cursor-pointer rounded hover:font-medium"
						th:classappend="${jobs} ? 'text-white bg-teal-700' :  'text-teal-700 hover:border-gray-300'">
						<a th:href="@{/admin/jobs}">Job Postings</a>
					</li>
					<li
						class="p-4 border-2 border-white cursor-pointer rounded hover:font-medium"
						th:classappend="${applications} ? 'text-white bg-teal-700' :  'text-teal-700 hover:border-gray-300'">
						<a th:href="@{/admin/applications}">Applications</a>
					</li>
					<li
						class="p-4 border-2 border-white cursor-pointer rounded hover:font-medium"
						th:classappend="${recruiters} ? 'text-white bg-teal-700' :  'text-teal-700 hover:border-gray-300'">
						<a th:href="@{/admin/recruiters}">Manage Recruiters</a>
					</li>
				</ul>
			</div>

			<div th:if="${users}" class="w-3/4 h-auto p-5 border-2 rounded">
				<div th:replace="fragments/admin/users :: all-users"></div>
			</div>
			<div th:if="${jobs}" class="w-3/4 h-auto p-5 border-2 rounded">
				<h2 class="text-2xl font-bold mb-4">Job Postings Management</h2>
				
				<button onclick="document.getElementById('createJobForm').classList.toggle('hidden')" 
					class="bg-teal-700 text-white px-4 py-2 rounded mb-4 hover:bg-teal-800">+ Create New Job</button>
				
				<div id="createJobForm" class="hidden mb-6 p-4 border-2 rounded bg-gray-50">
					<h3 class="text-lg font-semibold mb-3">Create Job Posting</h3>
					<form th:action="@{/admin/job/create}" method="post">
						<div class="grid grid-cols-2 gap-4">
							<input type="text" name="jobTitle" placeholder="Job Title" required class="border p-2 rounded" />
							<input type="text" name="location" placeholder="Location" required class="border p-2 rounded" />
							<input type="text" name="jobType" placeholder="Job Type (e.g., Full-time)" required class="border p-2 rounded" />
							<input type="text" name="experienceRequired" placeholder="Experience Required" required class="border p-2 rounded" />
						</div>
						<textarea name="jobDescription" placeholder="Job Description" required class="border p-2 rounded w-full mt-4" rows="3"></textarea>
						<textarea name="requiredSkills" placeholder="Required Skills (comma separated)" required class="border p-2 rounded w-full mt-4" rows="2"></textarea>
						<div class="mt-4">
							<button type="submit" class="bg-teal-700 text-white px-4 py-2 rounded hover:bg-teal-800">Create Job</button>
							<button type="button" onclick="document.getElementById('createJobForm').classList.add('hidden')" 
								class="bg-gray-500 text-white px-4 py-2 rounded ml-2 hover:bg-gray-600">Cancel</button>
						</div>
					</form>
				</div>
				
				<table class="w-full border-collapse">
					<thead>
						<tr class="bg-gray-200">
							<th class="border p-2 text-left">#</th>
							<th class="border p-2 text-left">Job Title</th>
							<th class="border p-2 text-left">Location</th>
							<th class="border p-2 text-left">Type</th>
							<th class="border p-2 text-left">Status</th>
							<th class="border p-2 text-left">Posted On</th>
							<th class="border p-2 text-left">Actions</th>
						</tr>
					</thead>
					<tbody>
						<tr th:if="${jobs.isEmpty()}">
							<td colspan="7" class="border p-4 text-center text-gray-500">No job postings available. Create one to get started.</td>
						</tr>
						<tr th:each="job, iterStat : ${jobs}" class="hover:bg-gray-50">
							<td class="border p-2" th:text="${iterStat.count}">1</td>
							<td class="border p-2" th:text="${job.jobTitle}">Job Title</td>
							<td class="border p-2" th:text="${job.location}">Location</td>
							<td class="border p-2" th:text="${job.jobType}">Type</td>
							<td class="border p-2">
								<span th:if="${job.isActive}" class="text-green-600 font-semibold">Active</span>
								<span th:unless="${job.isActive}" class="text-red-600 font-semibold">Inactive</span>
							</td>
							<td class="border p-2" th:text="${job.postedOn}">Date</td>
							<td class="border p-2">
								<form th:action="@{/admin/job/toggle/{id}(id=${job.jobId})}" method="post" style="display:inline;">
									<button type="submit" class="text-blue-600 hover:underline" th:text="${job.isActive} ? 'Deactivate' : 'Activate'">Toggle</button>
								</form>
								<span class="mx-1">|</span>
								<a th:href="@{/recruitment/job/{id}(id=${job.jobId})}" class="text-teal-600 hover:underline" target="_blank">View</a>
							</td>
						</tr>
					</tbody>
				</table>
			</div>
			<div th:if="${applications}" class="w-3/4 h-auto p-5 border-2 rounded">
				<h2 class="text-2xl font-bold mb-4">Applications Overview</h2>
				
				<div class="mb-4">
					<label class="mr-2">Filter by Status:</label>
					<select onchange="filterApplications(this.value)" class="border p-2 rounded">
						<option value="all">All Applications</option>
						<option value="Submitted">Submitted</option>
						<option value="Screening">Screening</option>
						<option value="Interview">Interview</option>
						<option value="Hired">Hired</option>
						<option value="Rejected">Rejected</option>
					</select>
				</div>
				
				<table class="w-full border-collapse">
					<thead>
						<tr class="bg-gray-200">
							<th class="border p-2 text-left">#</th>
							<th class="border p-2 text-left">Candidate</th>
							<th class="border p-2 text-left">Job Title</th>
							<th class="border p-2 text-left">AI Score</th>
							<th class="border p-2 text-left">Status</th>
							<th class="border p-2 text-left">Applied On</th>
							<th class="border p-2 text-left">Actions</th>
						</tr>
					</thead>
					<tbody>
						<tr th:if="${applications.isEmpty()}">
							<td colspan="7" class="border p-4 text-center text-gray-500">No applications received yet.</td>
						</tr>
						<tr th:each="app, iterStat : ${applications}" class="hover:bg-gray-50" th:attr="data-status=${app.status}">
							<td class="border p-2" th:text="${iterStat.count}">1</td>
							<td class="border p-2" th:text="${app.candidate?.username ?: 'N/A'}">Candidate</td>
							<td class="border p-2" th:text="${app.jobPosting?.jobTitle ?: 'N/A'}">Job</td>
							<td class="border p-2">
								<span th:if="${app.aiScore != null}" th:text="${#numbers.formatDecimal(app.aiScore, 1, 2)} + '%'" class="font-semibold">Score</span>
								<span th:unless="${app.aiScore != null}" class="text-gray-400">-</span>
							</td>
							<td class="border p-2">
								<span th:class="'px-2 py-1 rounded text-white ' + ${app.status == 'Hired' ? 'bg-green-600' : (app.status == 'Rejected' ? 'bg-red-600' : (app.status == 'Interview' ? 'bg-blue-600' : 'bg-yellow-600'))}" 
									th:text="${app.status}">Status</span>
							</td>
							<td class="border p-2" th:text="${app.appliedOn}">Date</td>
							<td class="border p-2">
								<a th:href="@{/admin/application/status/{id}(id=${app.applicationId},status='Screening')}" class="text-xs text-blue-600 hover:underline">Screen</a> |
								<a th:href="@{/admin/application/status/{id}(id=${app.applicationId},status='Interview')}" class="text-xs text-blue-600 hover:underline">Interview</a> |
								<a th:href="@{/admin/application/status/{id}(id=${app.applicationId},status='Hired')}" class="text-xs text-green-600 hover:underline">Hire</a> |
								<a th:href="@{/admin/application/status/{id}(id=${app.applicationId},status='Rejected')}" class="text-xs text-red-600 hover:underline">Reject</a>
							</td>
						</tr>
					</tbody>
				</table>
				
				<script>
				function filterApplications(status) {
					const rows = document.querySelectorAll('tbody tr[data-status]');
					rows.forEach(row => {
						if (status === 'all' || row.getAttribute('data-status') === status) {
							row.style.display = '';
						} else {
							row.style.display = 'none';
						}
					});
				}
				</script>
			</div>
			<div th:if="${recruiters}" class="w-3/4 h-auto p-5 border-2 rounded">
				<h2 class="text-2xl font-bold mb-4">Recruiter Management</h2>
				
				<button onclick="document.getElementById('createRecruiterForm').classList.toggle('hidden')" 
					class="bg-teal-700 text-white px-4 py-2 rounded mb-4 hover:bg-teal-800">+ Add New Recruiter</button>
				
				<div id="createRecruiterForm" class="hidden mb-6 p-4 border-2 rounded bg-gray-50">
					<h3 class="text-lg font-semibold mb-3">Create Recruiter Account</h3>
					<form th:action="@{/admin/recruiter/create}" method="post">
						<div class="grid grid-cols-2 gap-4">
							<input type="text" name="username" placeholder="Full Name" required class="border p-2 rounded" />
							<input type="email" name="email" placeholder="Email" required class="border p-2 rounded" />
						</div>
						<div class="mt-4">
							<button type="submit" class="bg-teal-700 text-white px-4 py-2 rounded hover:bg-teal-800">Create Recruiter</button>
							<button type="button" onclick="document.getElementById('createRecruiterForm').classList.add('hidden')" 
								class="bg-gray-500 text-white px-4 py-2 rounded ml-2 hover:bg-gray-600">Cancel</button>
						</div>
					</form>
				</div>
				
				<table class="w-full border-collapse">
					<thead>
						<tr class="bg-gray-200">
							<th class="border p-2 text-left">#</th>
							<th class="border p-2 text-left">Name</th>
							<th class="border p-2 text-left">Email</th>
							<th class="border p-2 text-left">Status</th>
							<th class="border p-2 text-left">Created On</th>
							<th class="border p-2 text-left">Actions</th>
						</tr>
					</thead>
					<tbody>
						<tr th:if="${recruiters.isEmpty()}">
							<td colspan="6" class="border p-4 text-center text-gray-500">No recruiters found. Add one to get started.</td>
						</tr>
						<tr th:each="recruiter, iterStat : ${recruiters}" class="hover:bg-gray-50">
							<td class="border p-2" th:text="${iterStat.count}">1</td>
							<td class="border p-2" th:text="${recruiter.username}">Name</td>
							<td class="border p-2" th:text="${recruiter.email}">Email</td>
							<td class="border p-2">
								<span th:if="${!recruiter.isLocked}" class="text-green-600 font-semibold">Active</span>
								<span th:if="${recruiter.isLocked}" class="text-red-600 font-semibold">Locked</span>
							</td>
							<td class="border p-2" th:text="${recruiter.createdOn}">Date</td>
							<td class="border p-2">
								<form th:action="@{/admin/recruiter/toggle/{id}(id=${recruiter.userId})}" method="post" style="display:inline;">
									<button type="submit" class="text-blue-600 hover:underline" th:text="${recruiter.isLocked} ? 'Unlock' : 'Lock'">Toggle</button>
								</form>
							</td>
						</tr>
					</tbody>
				</table>
			</div>

		</div>
	</div>
	<script type="text/javascript" th:src="@{/assets/js/app.js}"></script>
	<script type="text/javascript" th:src="@{/assets/js/controller.js}"></script>
</body>
</html>