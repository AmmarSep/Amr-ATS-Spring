<!DOCTYPE html>
<html xmlns:th="https://www.thymeleaf.org" ng-app="atsApp">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ATS - Admin Dashboard</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" type="text/css" th:href="@{/assets/css/style.css}">
    <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/angularjs/1.7.8/angular.min.js"></script>
</head>
<body ng-controller="adminHomeController">
    <div class="app-shell">
        <!-- Header -->
        <header class="app-header">
            <div class="app-header-content">
                <div class="app-logo">
                    <div class="app-logo-icon">
                        <i class="fas fa-users"></i>
                    </div>
                    <span>Spring ATS</span>
                </div>
                <nav class="app-nav">
                    <div class="app-nav-user">
                        <div class="app-nav-user-avatar">
                            <i class="fas fa-user-shield"></i>
                        </div>
                        <span th:text="${username}">Admin</span>
                    </div>
                    <a href="../logout" class="app-nav-link">
                        <i class="fas fa-sign-out-alt"></i> Logout
                    </a>
                </nav>
            </div>
        </header>

        <!-- Main Content Area -->
        <div class="app-main">
            <!-- Sidebar -->
            <aside class="app-sidebar">
                <nav class="sidebar-nav">
                    <a th:href="@{/admin/users}"
                       class="sidebar-nav-item"
                       th:classappend="${users} ? 'active' : ''">
                        <i class="fas fa-users-cog"></i>
                        <span>Manage Users</span>
                    </a>
                    <a th:href="@{/admin/jobs}"
                       class="sidebar-nav-item"
                       th:classappend="${jobs} ? 'active' : ''">
                        <i class="fas fa-briefcase"></i>
                        <span>Job Postings</span>
                    </a>
                    <a th:href="@{/admin/applications}"
                       class="sidebar-nav-item"
                       th:classappend="${applications} ? 'active' : ''">
                        <i class="fas fa-file-alt"></i>
                        <span>Applications</span>
                    </a>
                    <a th:href="@{/admin/recruiters}"
                       class="sidebar-nav-item"
                       th:classappend="${recruiters} ? 'active' : ''">
                        <i class="fas fa-user-plus"></i>
                        <span>Add Users</span>
                    </a>
                    <a th:href="@{/admin/hired-candidates}"
                       class="sidebar-nav-item"
                       th:classappend="${hiredCandidates} ? 'active' : ''">
                        <i class="fas fa-user-check"></i>
                        <span>Hired Candidates</span>
                    </a>
                    <a th:href="@{/admin/interview-scheduled}"
                       class="sidebar-nav-item"
                       th:classappend="${interviewScheduledCandidates} ? 'active' : ''">
                        <i class="fas fa-calendar-check"></i>
                        <span>Interviews</span>
                    </a>
                </nav>
            </aside>

            <!-- Content Area -->
            <main class="app-content">
                <div class="content-container">
                    <!-- Users Management -->
                    <div th:if="${users}" class="card animate-fade-in">
                        <div class="card-body">
                            <div th:replace="fragments/admin/users :: all-users"></div>
                        </div>
                    </div>

                    <!-- Job Postings Management -->
                    <div th:if="${jobs}" class="card animate-fade-in">
                        <div class="card-header">
                            <h2 class="card-title"><i class="fas fa-briefcase"></i> Job Postings Management</h2>
                        </div>
                        <div class="card-body">
                            <button onclick="document.getElementById('createJobForm').classList.toggle('hidden')"
                                class="btn btn-primary mb-4">
                                <i class="fas fa-plus"></i> Create New Job
                            </button>

                            <div id="createJobForm" class="hidden card mb-4" style="background: var(--gray-50);">
                                <div class="card-body">
                                    <h3 class="text-lg font-semibold mb-4">Create Job Posting</h3>
                                    <form th:action="@{/admin/job/create}" method="post">
                                        <div class="form-grid form-grid-2 mb-4">
                                            <div class="form-group mb-0">
                                                <input type="text" name="jobTitle" placeholder="Job Title" required class="form-input" />
                                            </div>
                                            <div class="form-group mb-0">
                                                <input type="text" name="location" placeholder="Location" required class="form-input" />
                                            </div>
                                            <div class="form-group mb-0">
                                                <input type="text" name="jobType" placeholder="Job Type (e.g., Full-time)" required class="form-input" />
                                            </div>
                                            <div class="form-group mb-0">
                                                <input type="text" name="experienceRequired" placeholder="Experience Required" required class="form-input" />
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <textarea name="jobDescription" placeholder="Job Description" required class="form-textarea" rows="3"></textarea>
                                        </div>
                                        <div class="form-group">
                                            <textarea name="requiredSkills" placeholder="Required Skills (comma separated)" required class="form-textarea" rows="2"></textarea>
                                        </div>
                                        <div class="btn-group">
                                            <button type="submit" class="btn btn-primary">
                                                <i class="fas fa-check"></i> Create Job
                                            </button>
                                            <button type="button" onclick="document.getElementById('createJobForm').classList.add('hidden')"
                                                class="btn btn-secondary">Cancel</button>
                                        </div>
                                    </form>
                                </div>
                            </div>

                            <div class="table-container">
                                <table class="table">
                                    <thead>
                                        <tr>
                                            <th>#</th>
                                            <th>Job Title</th>
                                            <th>Location</th>
                                            <th>Type</th>
                                            <th>Status</th>
                                            <th>Posted On</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr th:if="${jobs.isEmpty()}">
                                            <td colspan="7" class="text-center text-gray-500">No job postings available. Create one to get started.</td>
                                        </tr>
                                        <tr th:each="job, iterStat : ${jobs}">
                                            <td th:text="${iterStat.count}">1</td>
                                            <td class="font-medium" th:text="${job.jobTitle}">Job Title</td>
                                            <td th:text="${job.location}">Location</td>
                                            <td th:text="${job.jobType}">Type</td>
                                            <td>
                                                <span th:if="${job.isActive}" class="badge badge-solid-success">Active</span>
                                                <span th:unless="${job.isActive}" class="badge badge-solid-danger">Inactive</span>
                                            </td>
                                            <td th:text="${job.postedOn}">Date</td>
                                            <td>
                                                <div class="table-actions">
                                                    <form th:action="@{/admin/job/toggle/{id}(id=${job.jobId})}" method="post" style="display:inline;">
                                                        <button type="submit" class="btn btn-xs btn-info" th:text="${job.isActive} ? 'Deactivate' : 'Activate'">Toggle</button>
                                                    </form>
                                                    <a th:href="@{/recruitment/job/{id}(id=${job.jobId})}" class="btn btn-xs btn-secondary" target="_blank">View</a>
                                                </div>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>

                    <!-- Applications Overview -->
                    <div th:if="${applications}" class="card animate-fade-in">
                        <div class="card-header flex justify-between items-center">
                            <h2 class="card-title"><i class="fas fa-file-alt"></i> Applications</h2>
                            <div class="form-group mb-0">
                                <select onchange="filterApplications(this.value)" class="form-select" style="width: auto; font-size: 0.8rem; padding: 0.25rem 0.5rem;">
                                    <option value="all">All</option>
                                    <option value="Submitted">Submitted</option>
                                    <option value="Screening">Screening</option>
                                    <option value="Interview">Interview</option>
                                    <option value="Hired">Hired</option>
                                    <option value="Rejected">Rejected</option>
                                </select>
                            </div>
                        </div>
                        <div class="card-body" style="padding: 0.75rem;">
                            <div class="table-container">
                                <table class="table table-compact" style="table-layout: fixed; width: 100%; font-size: 0.8rem;">
                                    <thead>
                                        <tr>
                                            <th style="width: 25px;">#</th>
                                            <th style="width: 70px;">Name</th>
                                            <th style="width: 90px;">Job</th>
                                            <th style="width: 45px;">Score</th>
                                            <th style="width: 40px;">CV</th>
                                            <th style="width: 55px;">Status</th>
                                            <th style="width: 60px;">Date</th>
                                            <th style="width: 160px;">Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr th:if="${applications.isEmpty()}">
                                            <td colspan="8" class="text-center text-gray-500">No applications yet.</td>
                                        </tr>
                                        <tr th:each="app, iterStat : ${applications}" th:attr="data-status=${app.status}">
                                            <td th:text="${iterStat.count}">1</td>
                                            <td class="font-medium" style="overflow: hidden; text-overflow: ellipsis; white-space: nowrap;" th:text="${app.candidate?.username ?: 'N/A'}" th:title="${app.candidate?.username}">Name</td>
                                            <td style="word-wrap: break-word; white-space: normal; line-height: 1.2;" th:text="${app.jobPosting?.jobTitle ?: 'N/A'}" th:title="${app.jobPosting?.jobTitle}">Job</td>
                                            <td>
                                                <span th:if="${app.aiScore != null}" th:text="${#numbers.formatDecimal(app.aiScore, 1, 0)} + '%'" class="font-semibold text-primary-600">Score</span>
                                                <span th:unless="${app.aiScore != null}" class="text-gray-400">-</span>
                                            </td>
                                            <td>
                                                <a th:if="${app.resume != null}" th:href="@{/download/attachment(id=${app.resume.fileId})}"
                                                   class="text-primary-600" th:title="${app.resume.fileOriginalName}">
                                                    <i class="fas fa-download"></i>
                                                </a>
                                                <span th:unless="${app.resume != null}" class="text-gray-400">-</span>
                                            </td>
                                            <td>
                                                <span style="font-size: 0.65rem; padding: 2px 6px;" th:class="'badge ' + ${app.status == 'Hired' ? 'badge-solid-success' : (app.status == 'Rejected' ? 'badge-solid-danger' : (app.status == 'Interview' ? 'badge-solid-primary' : (app.status == 'Screening' ? 'badge-solid-warning' : 'badge-solid-info')))}"
                                                    th:text="${app.status}">Status</span>
                                            </td>
                                            <td style="white-space: nowrap; font-size: 0.75rem;" th:text="${app.appliedOn != null ? #dates.format(app.appliedOn, 'dd-MMM') : '-'}">Date</td>
                                            <td>
                                                <div class="table-actions" style="flex-wrap: nowrap; gap: 2px;">
                                                    <a th:href="@{/admin/application/status/{id}(id=${app.applicationId},status='Screening')}"
                                                       class="btn btn-xs btn-warning" style="padding: 2px 5px; font-size: 0.65rem;">Screen</a>
                                                    <a th:href="@{/admin/application/status/{id}(id=${app.applicationId},status='Interview')}"
                                                       class="btn btn-xs btn-primary" style="padding: 2px 5px; font-size: 0.65rem;">Interview</a>
                                                    <a th:href="@{/admin/application/status/{id}(id=${app.applicationId},status='Hired')}"
                                                       class="btn btn-xs btn-success" style="padding: 2px 5px; font-size: 0.65rem;">Hire</a>
                                                    <a th:href="@{/admin/application/status/{id}(id=${app.applicationId},status='Rejected')}"
                                                       class="btn btn-xs btn-danger" style="padding: 2px 5px; font-size: 0.65rem;">Reject</a>
                                                    <form th:action="@{/admin/application/delete/{id}(id=${app.applicationId})}" method="post" style="display:inline;">
                                                        <button type="submit" class="btn btn-xs btn-ghost text-error-600" style="padding: 2px 4px;" onclick="return confirm('Delete?')">
                                                            <i class="fas fa-trash" style="font-size: 0.7rem;"></i>
                                                        </button>
                                                    </form>
                                                </div>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>

                    <!-- Add Users (Recruiters) -->
                    <div th:if="${recruiters}" class="card animate-fade-in">
                        <div class="card-header">
                            <h2 class="card-title"><i class="fas fa-user-plus"></i> User Management</h2>
                        </div>
                        <div class="card-body">
                            <button onclick="document.getElementById('createRecruiterForm').classList.toggle('hidden')"
                                class="btn btn-primary mb-4">
                                <i class="fas fa-plus"></i> Add New User
                            </button>

                            <div id="createRecruiterForm" class="hidden card mb-4" style="background: var(--gray-50);">
                                <div class="card-body">
                                    <h3 class="text-lg font-semibold mb-4">Create User Account</h3>
                                    <form th:action="@{/admin/recruiter/create}" method="post">
                                        <div class="form-grid form-grid-2 mb-4">
                                            <div class="form-group mb-0">
                                                <input type="text" name="username" placeholder="Full Name" required class="form-input" />
                                            </div>
                                            <div class="form-group mb-0">
                                                <input type="email" name="email" placeholder="Email" required class="form-input" />
                                            </div>
                                        </div>
                                        <div class="btn-group">
                                            <button type="submit" class="btn btn-primary">
                                                <i class="fas fa-check"></i> Create User
                                            </button>
                                            <button type="button" onclick="document.getElementById('createRecruiterForm').classList.add('hidden')"
                                                class="btn btn-secondary">Cancel</button>
                                        </div>
                                    </form>
                                </div>
                            </div>

                            <div class="table-container">
                                <table class="table">
                                    <thead>
                                        <tr>
                                            <th>#</th>
                                            <th>Name</th>
                                            <th>Email</th>
                                            <th>Status</th>
                                            <th>Created On</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr th:if="${recruiters.isEmpty()}">
                                            <td colspan="6" class="text-center text-gray-500">No users found. Add one to get started.</td>
                                        </tr>
                                        <tr th:each="recruiter, iterStat : ${recruiters}">
                                            <td th:text="${iterStat.count}">1</td>
                                            <td class="font-medium" th:text="${recruiter.username}">Name</td>
                                            <td th:text="${recruiter.email}">Email</td>
                                            <td>
                                                <span th:if="${!recruiter.isLocked}" class="badge badge-solid-success">Active</span>
                                                <span th:if="${recruiter.isLocked}" class="badge badge-solid-danger">Locked</span>
                                            </td>
                                            <td th:text="${recruiter.createdOn}">Date</td>
                                            <td>
                                                <form th:action="@{/admin/recruiter/toggle/{id}(id=${recruiter.userId})}" method="post" style="display:inline;">
                                                    <button type="submit" class="btn btn-xs btn-info" th:text="${recruiter.isLocked} ? 'Unlock' : 'Lock'">Toggle</button>
                                                </form>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>

                    <!-- Hired Candidates -->
                    <div th:if="${hiredCandidates}" class="card animate-fade-in">
                        <div class="card-header">
                            <h2 class="card-title"><i class="fas fa-user-check"></i> Hired Candidates</h2>
                        </div>
                        <div class="card-body">
                            <div class="table-container">
                                <table class="table" style="table-layout: auto;">
                                    <thead>
                                        <tr>
                                            <th style="width: 40px;">#</th>
                                            <th>Candidate</th>
                                            <th>Score</th>
                                            <th>CV</th>
                                            <th>Position</th>
                                            <th style="white-space: nowrap;">Hired On</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr th:if="${hiredCandidates.isEmpty()}">
                                            <td colspan="6" class="text-center text-gray-500">No candidates have been hired yet.</td>
                                        </tr>
                                        <tr th:each="candidate, iterStat : ${hiredCandidates}">
                                            <td th:text="${iterStat.count}">1</td>
                                            <td class="font-medium" style="white-space: nowrap;" th:text="${candidate.candidate?.username ?: 'N/A'}">Name</td>
                                            <td style="white-space: nowrap;">
                                                <span th:if="${candidate.aiScore != null}" th:text="${#numbers.formatDecimal(candidate.aiScore, 1, 2)} + '%'" class="font-semibold text-success-600">Score</span>
                                                <span th:unless="${candidate.aiScore != null}" class="text-gray-400">-</span>
                                            </td>
                                            <td style="max-width: 200px; word-wrap: break-word; white-space: normal;">
                                                <div th:if="${candidate.resume != null}">
                                                    <a th:href="@{/download/attachment(id=${candidate.resume.fileId})}"
                                                       class="text-primary-600" target="_blank" th:title="${candidate.resume.fileOriginalName}">
                                                        <i class="fas fa-eye"></i>
                                                        <span th:text="${candidate.resume.fileOriginalName ?: 'View CV'}">View CV</span>
                                                    </a>
                                                </div>
                                                <span th:unless="${candidate.resume != null}" class="text-gray-400 text-xs">No CV</span>
                                            </td>
                                            <td th:text="${candidate.jobPosting?.jobTitle ?: 'N/A'}">Position</td>
                                            <td style="white-space: nowrap;" th:text="${candidate.appliedOn != null ? #dates.format(candidate.appliedOn, 'dd-MMM-yyyy') : 'N/A'}">Date</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>

                    <!-- Interview Scheduled Candidates -->
                    <div th:if="${interviewScheduledCandidates}" class="card animate-fade-in">
                        <div class="card-header">
                            <h2 class="card-title"><i class="fas fa-calendar-check"></i> Interviews</h2>
                        </div>
                        <div class="card-body" style="padding: 0.75rem;">
                            <div class="table-container">
                                <table class="table table-compact" style="table-layout: fixed; width: 100%; font-size: 0.85rem;">
                                    <thead>
                                        <tr>
                                            <th style="width: 25px;">#</th>
                                            <th style="width: 70px;">Name</th>
                                            <th style="width: 50px;">Score</th>
                                            <th style="width: 30px;">CV</th>
                                            <th style="width: 100px;">Position</th>
                                            <th style="width: 60px;">Date</th>
                                            <th style="width: 45px;">Time</th>
                                            <th style="width: 120px;">Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr th:if="${interviewScheduledCandidates.isEmpty()}">
                                            <td colspan="8" class="text-center text-gray-500">No interviews scheduled yet.</td>
                                        </tr>
                                        <tr th:each="candidate, iterStat : ${interviewScheduledCandidates}">
                                            <td th:text="${iterStat.count}">1</td>
                                            <td class="font-medium" style="overflow: hidden; text-overflow: ellipsis; white-space: nowrap;" th:text="${candidate.candidate?.username ?: 'N/A'}" th:title="${candidate.candidate?.username}">Name</td>
                                            <td>
                                                <span th:if="${candidate.aiScore != null}" th:text="${#numbers.formatDecimal(candidate.aiScore, 1, 0)} + '%'" class="font-semibold text-primary-600">Score</span>
                                                <span th:unless="${candidate.aiScore != null}" class="text-gray-400">-</span>
                                            </td>
                                            <td>
                                                <a th:if="${candidate.resume != null}" th:href="@{/download/attachment(id=${candidate.resume.fileId})}"
                                                   class="text-primary-600" target="_blank" title="View CV">
                                                    <i class="fas fa-eye"></i>
                                                </a>
                                                <span th:unless="${candidate.resume != null}" class="text-gray-400">-</span>
                                            </td>
                                            <td style="word-wrap: break-word; white-space: normal; line-height: 1.3; font-size: 0.8rem;" th:text="${candidate.jobPosting?.jobTitle ?: 'N/A'}">Position</td>
                                            <td style="white-space: nowrap; font-size: 0.8rem;">
                                                <span th:if="${candidate.interviewDate != null}" th:text="${#dates.format(candidate.interviewDate, 'dd-MMM')}">Date</span>
                                                <span th:unless="${candidate.interviewDate != null}" class="text-gray-400">-</span>
                                            </td>
                                            <td style="white-space: nowrap; font-size: 0.8rem;">
                                                <span th:if="${candidate.interviewTime != null}" th:text="${#dates.format(candidate.interviewTime, 'HH:mm')}">Time</span>
                                                <span th:unless="${candidate.interviewTime != null}" class="text-gray-400">-</span>
                                            </td>
                                            <td>
                                                <div class="table-actions" style="flex-wrap: nowrap; gap: 3px;">
                                                    <button th:if="${candidate.interviewDate == null}"
                                                        onclick="openScheduleModal(this)"
                                                        th:attr="data-application-id=${candidate.applicationId}, data-candidate-name=${candidate.candidate?.username}"
                                                        class="btn btn-xs btn-info">Schedule</button>
                                                    <button th:if="${candidate.interviewDate != null}"
                                                        onclick="openEditModal(this)"
                                                        th:attr="data-application-id=${candidate.applicationId}, data-candidate-name=${candidate.candidate?.username}, data-interview-date=${candidate.interviewDate}, data-interview-time=${candidate.interviewTime}, data-interviewer-name=${candidate.interviewerName}, data-interview-location=${candidate.interviewLocation}"
                                                        class="btn btn-xs btn-warning">Edit</button>
                                                    <form th:if="${candidate.interviewDate != null}" th:action="@{/admin/interview/cancel/{id}(id=${candidate.applicationId})}" method="post" style="display:inline;">
                                                        <button type="submit" class="btn btn-xs btn-danger" onclick="return confirm('Cancel interview?')">Cancel</button>
                                                    </form>
                                                </div>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <!-- Interview Scheduling Modal -->
    <div id="interviewModal" class="modal-overlay hidden">
        <div class="modal" style="max-width: 600px;">
            <div class="modal-header">
                <h3 class="modal-title" id="interviewModalTitle">Schedule Interview</h3>
                <button onclick="closeInterviewModal()" class="modal-close">&times;</button>
            </div>
            <form id="interviewForm" method="post" action="">
                <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
                <div class="modal-body">
                    <div class="form-group">
                        <label class="form-label">Candidate</label>
                        <input type="text" id="candidateName" readonly class="form-input" style="background: var(--gray-100);">
                    </div>
                    <div class="form-grid form-grid-2">
                        <div class="form-group">
                            <label class="form-label form-label-required">Interview Date</label>
                            <input type="date" name="interviewDate" id="interviewDate" required class="form-input">
                        </div>
                        <div class="form-group">
                            <label class="form-label form-label-required">Interview Time</label>
                            <input type="time" name="interviewTime" id="interviewTime" required class="form-input">
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Interviewer Name</label>
                        <input type="text" name="interviewerName" id="interviewerName" class="form-input">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Interview Location/Meeting Link</label>
                        <input type="text" name="interviewLocation" id="interviewLocation" placeholder="Office Room or Zoom/Teams link" class="form-input">
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" onclick="closeInterviewModal()" class="btn btn-secondary">Cancel</button>
                    <button type="submit" id="submitInterviewBtn" class="btn btn-primary">Save Interview</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // Application filter
        function filterApplications(status) {
            const rows = document.querySelectorAll('tbody tr[data-status]');
            rows.forEach(row => {
                if (status === 'all' || row.getAttribute('data-status') === status) {
                    row.style.display = '';
                } else {
                    row.style.display = 'none';
                }
            });
        }

        // Interview modal functions
        let currentApplicationId = null;
        let currentMode = 'schedule';

        function openScheduleModal(button) {
            currentApplicationId = button.getAttribute('data-application-id');
            currentMode = 'schedule';

            document.getElementById('interviewModalTitle').textContent = 'Schedule Interview';
            document.getElementById('candidateName').value = button.getAttribute('data-candidate-name');

            const formAction = window.location.origin + '/ats/admin/interview/schedule/' + currentApplicationId;
            document.getElementById('interviewForm').setAttribute('action', formAction);

            document.getElementById('interviewDate').value = '';
            document.getElementById('interviewTime').value = '';
            document.getElementById('interviewerName').value = '';
            document.getElementById('interviewLocation').value = '';

            document.getElementById('interviewModal').classList.remove('hidden');
            document.getElementById('interviewModal').classList.add('active');
        }

        function openEditModal(button) {
            currentApplicationId = button.getAttribute('data-application-id');
            currentMode = 'edit';

            document.getElementById('interviewModalTitle').textContent = 'Edit Interview';
            document.getElementById('candidateName').value = button.getAttribute('data-candidate-name');

            const formAction = window.location.origin + '/ats/admin/interview/update/' + currentApplicationId;
            document.getElementById('interviewForm').setAttribute('action', formAction);

            const interviewDate = button.getAttribute('data-interview-date');
            const interviewTime = button.getAttribute('data-interview-time');

            if (interviewDate && interviewDate !== 'null') {
                document.getElementById('interviewDate').value = interviewDate;
            }
            if (interviewTime && interviewTime !== 'null') {
                document.getElementById('interviewTime').value = interviewTime;
            }
            document.getElementById('interviewerName').value = button.getAttribute('data-interviewer-name') || '';
            document.getElementById('interviewLocation').value = button.getAttribute('data-interview-location') || '';

            document.getElementById('interviewModal').classList.remove('hidden');
            document.getElementById('interviewModal').classList.add('active');
        }

        function closeInterviewModal() {
            document.getElementById('interviewModal').classList.add('hidden');
            document.getElementById('interviewModal').classList.remove('active');
            currentApplicationId = null;
        }

        document.getElementById('interviewModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeInterviewModal();
            }
        });
    </script>

    <script type="text/javascript" th:src="@{/assets/js/app.js}"></script>
    <script type="text/javascript" th:src="@{/assets/js/controller.js}"></script>
</body>
</html>