<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Apply for Job - ATS</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" th:href="@{/assets/css/style.css}">
</head>
<body style="background: var(--gray-100);">
    <div style="min-height: 100vh; padding: var(--space-6); display: flex; align-items: center; justify-content: center;">
        <div class="card animate-fade-in" style="width: 100%; max-width: 700px;">
            <!-- Header -->
            <div class="card-header" style="background: linear-gradient(135deg, var(--primary-600), var(--primary-800)); color: white; padding: var(--space-8); text-align: center;">
                <a th:href="@{/recruitment/job/{id}(id=${job.jobId})}" style="color: rgba(255,255,255,0.8); text-decoration: none; font-size: var(--text-sm); display: inline-flex; align-items: center; gap: var(--space-2); margin-bottom: var(--space-4);">
                    <i class="fas fa-arrow-left"></i> Back to Job Details
                </a>

                <h1 style="font-size: var(--text-2xl); font-weight: var(--font-bold); margin-bottom: var(--space-4);">
                    Apply for: <span th:text="${job.jobTitle}">Job Title</span>
                </h1>

                <div class="flex justify-center gap-3 flex-wrap">
                    <span class="badge" style="background: rgba(255,255,255,0.2); color: white;">
                        <i class="fas fa-map-marker-alt"></i>
                        <span th:text="${job.location ?: 'Location'}">Location</span>
                    </span>
                    <span class="badge" style="background: rgba(255,255,255,0.2); color: white;">
                        <i class="fas fa-briefcase"></i>
                        <span th:text="${job.jobType ?: 'Full-time'}">Type</span>
                    </span>
                </div>

                <p style="font-size: var(--text-sm); opacity: 0.8; margin-top: var(--space-4);">
                    Step 1 of 1 - Application Submission
                </p>
            </div>

            <!-- Form Body -->
            <div class="card-body" style="padding: var(--space-8);">
                <form th:action="@{/recruitment/apply}" method="post" enctype="multipart/form-data" id="applicationForm">
                    <input type="hidden" name="jobRef" th:value="${job.jobId}">

                    <!-- Resume Upload -->
                    <div class="form-group mb-6">
                        <h3 style="font-size: var(--text-lg); font-weight: var(--font-semibold); margin-bottom: var(--space-4); display: flex; align-items: center; gap: var(--space-2);">
                            <i class="fas fa-file-upload" style="color: var(--primary-600);"></i>
                            Resume Upload
                        </h3>
                        <label class="form-label form-label-required">Upload your resume</label>

                        <div style="margin-bottom: var(--space-3);">
                            <input type="file" name="resume" accept=".pdf,.doc,.docx" required id="resumeInput" style="display: none;">
                            <label for="resumeInput" class="btn btn-primary" style="cursor: pointer;">
                                <i class="fas fa-upload"></i> Choose Resume File
                            </label>
                            <p class="form-hint">PDF, DOC, DOCX - Max 5MB</p>
                        </div>

                        <div id="selectedFileInfo" class="hidden" style="padding: var(--space-4); background: var(--success-50); border: 1px solid var(--success-500); border-radius: var(--radius-lg);">
                            <div class="flex items-center gap-4">
                                <i class="fas fa-file-alt" style="font-size: var(--text-xl); color: var(--success-600);"></i>
                                <div style="flex: 1;">
                                    <div id="fileName" class="font-medium" style="color: var(--success-700);"></div>
                                    <div id="fileSize" class="text-sm" style="color: var(--success-600);"></div>
                                </div>
                                <button type="button" id="removeFile" class="btn btn-ghost" style="color: var(--error-600);">
                                    <i class="fas fa-times"></i>
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Cover Letter -->
                    <div class="form-group mb-6">
                        <h3 style="font-size: var(--text-lg); font-weight: var(--font-semibold); margin-bottom: var(--space-4); display: flex; align-items: center; gap: var(--space-2);">
                            <i class="fas fa-edit" style="color: var(--primary-600);"></i>
                            Cover Letter
                        </h3>
                        <label class="form-label">Why are you perfect for this role? (Optional)</label>
                        <div style="position: relative;">
                            <textarea
                                name="notes"
                                class="form-textarea"
                                placeholder="Tell us about your relevant experience, skills, and what excites you about this opportunity..."
                                maxlength="500"
                                id="coverLetter"
                                rows="4"></textarea>
                            <span id="charCounter" style="position: absolute; bottom: var(--space-3); right: var(--space-4); font-size: var(--text-xs); color: var(--gray-400);">0/500</span>
                        </div>
                    </div>

                    <!-- Privacy Notice -->
                    <div class="alert alert-warning mb-6">
                        <i class="fas fa-shield-alt alert-icon"></i>
                        <div class="alert-content">
                            Your information is secure and confidential. We respect your privacy.
                        </div>
                    </div>

                    <!-- Actions -->
                    <div style="display: flex; justify-content: space-between; align-items: center; padding-top: var(--space-6); border-top: 1px solid var(--gray-200); flex-wrap: wrap; gap: var(--space-4);">
                        <span class="text-sm text-gray-500">
                            <i class="fas fa-clock"></i> Takes ~3 minutes
                        </span>

                        <div class="btn-group">
                            <a th:href="@{/recruitment/job/{id}(id=${job.jobId})}" class="btn btn-secondary">
                                <i class="fas fa-times"></i> Cancel
                            </a>
                            <button type="submit" class="btn btn-primary btn-lg" id="submitBtn">
                                <i class="fas fa-paper-plane"></i> Submit Application
                            </button>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script>
        const fileInput = document.getElementById('resumeInput');
        const selectedFileInfo = document.getElementById('selectedFileInfo');
        const fileName = document.getElementById('fileName');
        const fileSize = document.getElementById('fileSize');
        const removeFile = document.getElementById('removeFile');
        const coverLetter = document.getElementById('coverLetter');
        const charCounter = document.getElementById('charCounter');
        const submitBtn = document.getElementById('submitBtn');

        fileInput.addEventListener('change', function() {
            if (this.files && this.files.length > 0) {
                const file = this.files[0];
                fileName.textContent = file.name;
                fileSize.textContent = `${(file.size / 1024 / 1024).toFixed(1)} MB`;
                selectedFileInfo.classList.remove('hidden');
            }
        });

        removeFile.addEventListener('click', function() {
            fileInput.value = '';
            selectedFileInfo.classList.add('hidden');
        });

        coverLetter.addEventListener('input', function() {
            const count = this.value.length;
            charCounter.textContent = count + '/500';
            charCounter.style.color = count > 450 ? 'var(--error-500)' : 'var(--gray-400)';
        });

        let isSubmitting = false;
        document.getElementById('applicationForm').addEventListener('submit', function(e) {
            if (isSubmitting) {
                e.preventDefault();
                return false;
            }

            if (!fileInput.files || fileInput.files.length === 0) {
                e.preventDefault();
                alert('Please select a resume file before submitting.');
                return false;
            }

            isSubmitting = true;
            submitBtn.disabled = true;
            submitBtn.innerHTML = '<i class="fas fa-spinner animate-spin"></i> Submitting...';
        });
    </script>
</body>
</html>